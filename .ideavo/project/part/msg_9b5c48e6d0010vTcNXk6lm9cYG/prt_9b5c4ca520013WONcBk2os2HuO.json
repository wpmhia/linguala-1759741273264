{
  "id": "prt_9b5c4ca520013WONcBk2os2HuO",
  "messageID": "msg_9b5c48e6d0010vTcNXk6lm9cYG",
  "sessionID": "ses_65b8a18f2ffeMlgQ4UP0yHPHsm",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_015oaFwzZWkycsNBMbe8Mscs",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/lib/translation-service.ts"
    },
    "output": "<file>\n00001| /**\n00002|  * Translation Service for Linguala Platform\n00003|  * \n00004|  * This service uses Alibaba Cloud DashScope's qwen-mt-turbo model for translation only.\n00005|  * Simple, clean implementation focused on language translation.\n00006|  * \n00007|  * REQUIRED ENVIRONMENT VARIABLE:\n00008|  * - DASHSCOPE_API_KEY: Alibaba Cloud API key (format: sk-xxxxxxxxxxxxxxxxx)\n00009|  */\n00010| \n00011| // Language mapping for translation API - includes all frontend languages\n00012| const LANGUAGE_MAP: Record<string, string> = {\n00013|   auto: 'auto',\n00014|   \n00015|   // Popular EU Languages\n00016|   en: 'English',\n00017|   de: 'German', \n00018|   fr: 'French',\n00019|   es: 'Spanish',\n00020|   it: 'Italian',\n00021|   pt: 'Portuguese',\n00022|   pl: 'Polish',\n00023|   nl: 'Dutch',\n00024|   \n00025|   // Nordic Languages\n00026|   da: 'Danish',\n00027|   sv: 'Swedish',\n00028|   no: 'Norwegian',\n00029|   fi: 'Finnish',\n00030|   \n00031|   // Eastern European\n00032|   ru: 'Russian',\n00033|   uk: 'Ukrainian',\n00034|   cs: 'Czech',\n00035|   sk: 'Slovak',\n00036|   hu: 'Hungarian',\n00037|   ro: 'Romanian',\n00038|   bg: 'Bulgarian',\n00039|   hr: 'Croatian',\n00040|   sr: 'Serbian',\n00041|   sl: 'Slovenian',\n00042|   et: 'Estonian',\n00043|   lv: 'Latvian',\n00044|   lt: 'Lithuanian',\n00045|   \n00046|   // Popular Languages\n00047|   zh: 'Chinese',\n00048|   ja: 'Japanese',\n00049|   ko: 'Korean',\n00050|   ar: 'Arabic',\n00051|   hi: 'Hindi',\n00052|   tr: 'Turkish',\n00053|   he: 'Hebrew',\n00054|   \n00055|   // Additional European\n00056|   el: 'Greek',\n00057|   mt: 'Maltese',\n00058|   is: 'Icelandic',\n00059|   ga: 'Irish',\n00060|   cy: 'Welsh',\n00061|   eu: 'Basque',\n00062|   ca: 'Catalan'\n00063| }\n00064| \n00065| export interface TranslationResult {\n00066|   translatedText: string\n00067|   sourceLang: string\n00068|   targetLang: string\n00069|   fallback?: boolean\n00070| }\n00071| \n00072| // Simple translation function using qwen-mt-turbo\n00073| async function translateWithQwenMT(text: string, sourceLang: string, targetLang: string): Promise<TranslationResult> {\n00074|   const DASHSCOPE_API_KEY = process.env.DASHSCOPE_API_KEY\n00075|   \n00076|   if (!DASHSCOPE_API_KEY) {\n00077|     throw new Error('DASHSCOPE_API_KEY not configured')\n00078|   }\n00079|   \n00080|   console.log(`Translating with qwen-mt-turbo: \"${text.substring(0, 50)}\" from ${sourceLang} to ${targetLang}`)\n00081|   \n00082|   try {\n00083|     const response = await fetch('https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions', {\n00084|       method: 'POST',\n00085|       headers: {\n00086|         'Authorization': `Bearer ${DASHSCOPE_API_KEY}`,\n00087|         'Content-Type': 'application/json',\n00088|       },\n00089|       body: JSON.stringify({\n00090|         model: 'qwen-mt-turbo',\n00091|         messages: [\n00092|           {\n00093|             role: 'user',\n00094|             content: `Translate from ${sourceLang === 'auto' ? 'auto-detected language' : sourceLang} to ${targetLang}: ${text}`\n00095|           }\n00096|         ],\n00097|         max_tokens: 500,\n00098|         temperature: 0.1\n00099|       })\n00100|     })\n00101|     \n00102|     console.log('qwen-mt-turbo response status:', response.status)\n00103|     \n00104|     if (!response.ok) {\n00105|       throw new Error(`API request failed: ${response.status}`)\n00106|     }\n00107| \n00108|     const data = await response.json()\n00109|     const translatedText = data.choices[0]?.message?.content?.trim()\n00110| \n00111|     if (translatedText && translatedText !== text) {\n00112|       console.log('Translation successful:', translatedText)\n00113|       return {\n00114|         translatedText,\n00115|         sourceLang: sourceLang === 'auto' ? 'auto' : sourceLang,\n00116|         targetLang\n00117|       }\n00118|     } else {\n00119|       throw new Error('No translation received or same as input')\n00120|     }\n00121|   } catch (error) {\n00122|     console.error('qwen-mt-turbo translation error:', error)\n00123|     throw error\n00124|   }\n00125| }\n00126| \n00127| // Main translation function\n00128| export async function translateText(\n00129|   text: string, \n00130|   sourceLang: string, \n00131|   targetLang: string,\n00132|   options?: {\n00133|     domain?: string\n00134|     glossary?: Array<{ source: string; target: string }>\n00135|   }\n00136| ): Promise<TranslationResult> {\n00137|   try {\n00138|     if (!text || !targetLang) {\n00139|       throw new Error('Text and target language are required')\n00140|     }\n00141| \n00142|     // Map language codes to full names\n00143|     const targetLanguage = LANGUAGE_MAP[targetLang] || targetLang\n00144|     const sourceLanguage = sourceLang && sourceLang !== 'auto' ? LANGUAGE_MAP[sourceLang] || sourceLang : 'auto'\n00145|     \n00146|     // Try qwen-mt-turbo translation first\n00147|     try {\n00148|       const result = await translateWithQwenMT(text, sourceLanguage, targetLanguage)\n00149|       return result\n00150|     } catch (error) {\n00151|       console.error('qwen-mt-turbo translation failed, using fallback:', error)\n00152|       \n00153|       // Try fallback translation for common phrases\n00154|       const fallbackTranslation = getFallbackTranslation(text, targetLanguage)\n00155|       if (fallbackTranslation) {\n00156|         return {\n00157|           translatedText: fallbackTranslation,\n00158|           sourceLang,\n00159|           targetLang,\n00160|           fallback: true\n00161|         }\n00162|       }\n00163| \n00164|       // Enhanced pattern-based translation fallback\n00165|       const result = getPatternBasedTranslation(text, targetLanguage)\n00166|       return {\n00167|         translatedText: result,\n00168|         sourceLang,\n00169|         targetLang,\n00170|         fallback: true\n00171|       }\n00172|     }\n00173|     \n00174|   } catch (error) {\n00175|     console.error('Translation error:', error)\n00176|     return {\n00177|       translatedText: text,\n00178|       sourceLang,\n00179|       targetLang,\n00180|       fallback: true\n00181|     }\n00182|   }\n00183| }\n00184| \n00185| // Fallback translation for common phrases\n00186| function getFallbackTranslation(text: string, targetLanguage: string): string | null {\n00187|   const commonTranslations: Record<string, Record<string, string>> = {\n00188|     'hello': {\n00189|       'Spanish': 'hola',\n00190|       'French': 'bonjour',\n00191|       'German': 'hallo',\n00192|       'Italian': 'ciao',\n00193|       'Portuguese': 'olá'\n00194|     },\n00195|     'goodbye': {\n00196|       'Spanish': 'adiós',\n00197|       'French': 'au revoir',\n00198|       'German': 'auf wiedersehen',\n00199|       'Italian': 'ciao',\n00200|       'Portuguese': 'tchau'\n00201|     },\n00202|     'thank you': {\n00203|       'Spanish': 'gracias',\n00204|       'French': 'merci',\n00205|       'German': 'danke',\n00206|       'Italian': 'grazie',\n00207|       'Portuguese': 'obrigado'\n00208|     },\n00209|     'please': {\n00210|       'Spanish': 'por favor',\n00211|       'French': 's\\'il vous plaît',\n00212|       'German': 'bitte',\n00213|       'Italian': 'per favore',\n00214|       'Portuguese': 'por favor'\n00215|     },\n00216|     'yes': {\n00217|       'Spanish': 'sí',\n00218|       'French': 'oui',\n00219|       'German': 'ja',\n00220|       'Italian': 'sì',\n00221|       'Portuguese': 'sim'\n00222|     },\n00223|     'no': {\n00224|       'Spanish': 'no',\n00225|       'French': 'non',\n00226|       'German': 'nein',\n00227|       'Italian': 'no',\n00228|       'Portuguese': 'não'\n00229|     }\n00230|   }\n00231| \n00232|   const lowerText = text.toLowerCase().trim()\n00233|   return commonTranslations[lowerText]?.[targetLanguage] || null\n00234| }\n00235| \n00236| // Enhanced pattern-based translation for common text\n00237| function getPatternBasedTranslation(text: string, targetLanguage: string): string {\n00238|   const lowerText = text.toLowerCase().trim()\n00239|   \n00240|   // Common words and phrases\n00241|   const translations: Record<string, Record<string, string>> = {\n00242|     // Greetings\n00243|     'hello': { 'Spanish': 'hola', 'French': 'bonjour', 'German': 'hallo', 'Italian': 'ciao', 'Portuguese': 'olá' },\n00244|     'hello world': { 'Spanish': 'hola mundo', 'French': 'bonjour le monde', 'German': 'hallo welt', 'Italian': 'ciao mondo', 'Portuguese': 'olá mundo' },\n00245|     'good morning': { 'Spanish': 'buenos días', 'French': 'bonjour', 'German': 'guten morgen', 'Italian': 'buongiorno', 'Portuguese': 'bom dia' },\n00246|     'good evening': { 'Spanish': 'buenas tardes', 'French': 'bonsoir', 'German': 'guten abend', 'Italian': 'buonasera', 'Portuguese': 'boa tarde' },\n00247|     'good night': { 'Spanish': 'buenas noches', 'French': 'bonne nuit', 'German': 'gute nacht', 'Italian': 'buonanotte', 'Portuguese': 'boa noite' },\n00248|     \n00249|     // Common phrases\n00250|     'thank you': { 'Spanish': 'gracias', 'French': 'merci', 'German': 'danke', 'Italian': 'grazie', 'Portuguese': 'obrigado' },\n00251|     'please': { 'Spanish': 'por favor', 'French': 's\\'il vous plaît', 'German': 'bitte', 'Italian': 'per favore', 'Portuguese': 'por favor' },\n00252|     'excuse me': { 'Spanish': 'disculpe', 'French': 'excusez-moi', 'German': 'entschuldigung', 'Italian': 'scusi', 'Portuguese': 'com licença' },\n00253|     'yes': { 'Spanish': 'sí', 'French': 'oui', 'German': 'ja', 'Italian': 'sì', 'Portuguese': 'sim' },\n00254|     'no': { 'Spanish': 'no', 'French': 'non', 'German': 'nein', 'Italian': 'no', 'Portuguese': 'não' },\n00255|     \n00256|     // Common words\n00257|     'cat': { 'Spanish': 'gato', 'French': 'chat', 'German': 'katze', 'Italian': 'gatto', 'Portuguese': 'gato' },\n00258|     'dog': { 'Spanish': 'perro', 'French': 'chien', 'German': 'hund', 'Italian': 'cane', 'Portuguese': 'cão' },\n00259|     'water': { 'Spanish': 'agua', 'French': 'eau', 'German': 'wasser', 'Italian': 'acqua', 'Portuguese': 'água' },\n00260|     'food': { 'Spanish': 'comida', 'French': 'nourriture', 'German': 'essen', 'Italian': 'cibo', 'Portuguese': 'comida' },\n00261|     'house': { 'Spanish': 'casa', 'French': 'maison', 'German': 'haus', 'Italian': 'casa', 'Portuguese': 'casa' },\n00262|     'love': { 'Spanish': 'amor', 'French': 'amour', 'German': 'liebe', 'Italian': 'amore', 'Portuguese': 'amor' },\n00263|     'world': { 'Spanish': 'mundo', 'French': 'monde', 'German': 'welt', 'Italian': 'mondo', 'Portuguese': 'mundo' },\n00264|     'time': { 'Spanish': 'tiempo', 'French': 'temps', 'German': 'zeit', 'Italian': 'tempo', 'Portuguese': 'tempo' },\n00265|     'book': { 'Spanish': 'libro', 'French': 'livre', 'German': 'buch', 'Italian': 'libro', 'Portuguese': 'livro' },\n00266|     'car': { 'Spanish': 'coche', 'French': 'voiture', 'German': 'auto', 'Italian': 'macchina', 'Portuguese': 'carro' }\n00267|   }\n00268|   \n00269|   // Try exact phrase match first\n00270|   if (translations[lowerText] && translations[lowerText][targetLanguage]) {\n00271|     return translations[lowerText][targetLanguage]\n00272|   }\n00273|   \n00274|   // Try word-by-word translation for simple sentences\n00275|   const words = lowerText.split(' ')\n00276|   const translatedWords = words.map(word => {\n00277|     const cleanWord = word.replace(/[.,!?;:]/, '')\n00278|     return translations[cleanWord]?.[targetLanguage] || word\n00279|   })\n00280|   \n00281|   const result = translatedWords.join(' ')\n00282|   \n00283|   // If we got some translations, return result; otherwise indicate it needs proper translation\n00284|   if (result !== text) {\n00285|     return result\n00286|   }\n00287|   \n00288|   return `[Translated to ${targetLanguage}] ${text}`\n00289| }\n</file>",
    "metadata": {
      "preview": "/**\n * Translation Service for Linguala Platform\n * \n * This service uses Alibaba Cloud DashScope's qwen-mt-turbo model for translation only.\n * Simple, clean implementation focused on language translation.\n * \n * REQUIRED ENVIRONMENT VARIABLE:\n * - DASHSCOPE_API_KEY: Alibaba Cloud API key (format: sk-xxxxxxxxxxxxxxxxx)\n */\n\n// Language mapping for translation API - includes all frontend languages\nconst LANGUAGE_MAP: Record<string, string> = {\n  auto: 'auto',\n  \n  // Popular EU Languages\n  en: 'English',\n  de: 'German', \n  fr: 'French',\n  es: 'Spanish',\n  it: 'Italian',"
    },
    "title": "lib/translation-service.ts",
    "time": {
      "start": 1759691197694,
      "end": 1759691197700
    }
  }
}